<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><!-- Primary meta --><title>Architecture â€“ BLite</title><meta name="description" content="Dive into BLite's internals: the Span-based I/O pipeline, WAL engine, B-Tree/R-Tree indexes, and how source generators wire everything together."><meta name="keywords" content="BLite, embedded database, .NET database, BSON, zero allocation, ACID transactions, CDC, Change Data Capture, document store, NoSQL, .NET 10, source generators, spatial index, R-Tree"><meta name="author" content="BLite Project"><meta name="robots" content="index, follow"><meta name="theme-color" content="#e74c3c"><link rel="canonical" href="https://blitedb.com/docs/architecture"><!-- Favicon --><link rel="icon" type="image/svg+xml" href="/icon.svg"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:site_name" content="BLite"><meta property="og:url" content="https://blitedb.com/docs/architecture"><meta property="og:title" content="Architecture â€“ BLite"><meta property="og:description" content="Dive into BLite's internals: the Span-based I/O pipeline, WAL engine, B-Tree/R-Tree indexes, and how source generators wire everything together."><meta property="og:image" content="https://blitedb.com/og-image.png"><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Architecture â€“ BLite"><meta name="twitter:description" content="Dive into BLite's internals: the Span-based I/O pipeline, WAL engine, B-Tree/R-Tree indexes, and how source generators wire everything together."><meta name="twitter:image" content="https://blitedb.com/og-image.png"><!-- JSON-LD Structured Data --><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "BLite",
    "url": "https://blitedb.com",
    "description": "BLite is a high-performance, embedded, ACID-compliant BSON document store for .NET 10. Features zero-allocation I/O, Change Data Capture, R-Tree spatial indexing, and compile-time source generators.",
    "applicationCategory": "DeveloperApplication",
    "operatingSystem": "Windows, Linux, macOS",
    "programmingLanguage": "C#",
    "license": "https://opensource.org/licenses/MIT",
    "codeRepository": "https://github.com/EntglDb/BLite",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "keywords": "embedded database, BSON, .NET, zero allocation, ACID, CDC, NoSQL"
  }</script><script type="module" async="" crossorigin="" src="/assets/app-b_-VbZ7y.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-Dn3sjlTS.css"></head><body><div id="app" data-server-rendered="true"><div class="app-layout" data-v-94ca611f=""><header class="main-header glass-panel" data-v-94ca611f=""><div class="container header-content" data-v-94ca611f=""><a href="/" class="logo-link" data-v-94ca611f=""><img src="/icon.svg" alt="BLite" class="logo-img" data-v-94ca611f=""><div class="logo-text" data-v-94ca611f="">BLite<span class="dot" data-v-94ca611f="">.</span></div></a><nav data-v-94ca611f=""><a href="/" class="" data-v-94ca611f="">Home</a><a href="/docs" class="router-link-active" data-v-94ca611f="">Docs</a><a href="/comparisons" class="" data-v-94ca611f="">Comparisons</a><a href="https://github.com/EntglDb/BLite" target="_blank" class="github-link" data-v-94ca611f="">GitHub â†—</a></nav></div></header><main data-v-94ca611f=""><div class="docs-layout" data-v-94ca611f="" data-v-a567941b=""><aside class="docs-sidebar" data-v-a567941b=""><div class="sidebar-header" data-v-a567941b=""><h2 data-v-a567941b="">Documentation</h2></div><nav class="sidebar-nav" data-v-a567941b=""><!--[--><a href="/docs/getting-started" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸš€</span><span class="nav-label" data-v-a567941b="">Getting Started</span></a><a href="/docs/installation" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ“¦</span><span class="nav-label" data-v-a567941b="">Installation</span></a><a href="/docs/transactions" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ”„</span><span class="nav-label" data-v-a567941b="">Transactions &amp; Async</span></a><a href="/docs/crud" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">âœï¸</span><span class="nav-label" data-v-a567941b="">CRUD Operations</span></a><a href="/docs/querying" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ”</span><span class="nav-label" data-v-a567941b="">Querying</span></a><a href="/docs/generators" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ¤–</span><span class="nav-label" data-v-a567941b="">Source Generators</span></a><a href="/docs/cdc" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ“¡</span><span class="nav-label" data-v-a567941b="">Change Data Capture</span></a><a href="/docs/spatial" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸŒ</span><span class="nav-label" data-v-a567941b="">Spatial Indexing</span></a><a aria-current="page" href="/docs/architecture" class="router-link-active router-link-exact-active active nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ—ï¸</span><span class="nav-label" data-v-a567941b="">Architecture</span></a><a href="/docs/converters" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ†”</span><span class="nav-label" data-v-a567941b="">Custom ID Converters</span></a><a href="/docs/benchmarks" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">âš¡</span><span class="nav-label" data-v-a567941b="">Benchmarks</span></a><a href="/docs/dynamic-api" class="nav-item" data-v-a567941b=""><span class="nav-icon" data-v-a567941b="">ğŸ”Œ</span><span class="nav-label" data-v-a567941b="">Schema-less API</span></a><!--]--></nav></aside><main class="docs-content" data-v-a567941b=""><div class="container" data-v-a567941b=""><div class="doc-page" data-v-a567941b="" data-v-3d7cac45=""><h1 data-v-3d7cac45="">ğŸ—ï¸ <span class="title-gradient" data-v-3d7cac45="">Architecture</span></h1><p class="lead" data-v-3d7cac45="">Deep dive into BLite's internal architecture, storage engine, and BSON format.</p><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Storage Engine</h2><p data-v-3d7cac45="">BLite uses a <strong data-v-3d7cac45="">page-based storage engine</strong> with memory-mapped files:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45=""><strong data-v-3d7cac45="">PageFile</strong> - Memory-mapped file manager</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">Write-Ahead Log (WAL)</strong> - Durability and crash recovery</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">SlottedPage</strong> - Variable-length record storage</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">B-Tree Index</strong> - Logarithmic key lookups</li></ul></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Page Structure</h2><pre data-v-3d7cac45=""><code data-v-3d7cac45=""><span class="comment" data-v-3d7cac45="">// Page Header (32 bytes)</span>
<span class="keyword" data-v-3d7cac45="">struct</span> <span class="type" data-v-3d7cac45="">PageHeader</span>
{
    <span class="keyword" data-v-3d7cac45="">uint</span> PageId;
    <span class="keyword" data-v-3d7cac45="">ushort</span> PageType;  <span class="comment" data-v-3d7cac45="">// Data, Index, Free</span>
    <span class="keyword" data-v-3d7cac45="">ushort</span> FreeSpace;
    <span class="keyword" data-v-3d7cac45="">uint</span> NextPageId;
    <span class="comment" data-v-3d7cac45="">// ...</span>
}</code></pre></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">C-BSON Format</h2><p data-v-3d7cac45="">BLite uses <strong data-v-3d7cac45="">C-BSON (Compressed BSON)</strong> - a space-efficient variant that achieves 30-60% size reduction through field name compression:</p><h3 data-v-3d7cac45="">Key Compression</h3><p data-v-3d7cac45="">Standard BSON stores field names as null-terminated strings in every document. C-BSON replaces them with <strong data-v-3d7cac45="">2-byte numeric field IDs</strong>:</p><pre data-v-3d7cac45=""><code data-v-3d7cac45=""><span class="comment" data-v-3d7cac45="">// Standard BSON element</span>
[<span class="number" data-v-3d7cac45="">1</span> byte: type][N bytes: <span class="string" data-v-3d7cac45="">"field_name\0"</span>][value]

<span class="comment" data-v-3d7cac45="">// C-BSON element (compressed)</span>
[<span class="number" data-v-3d7cac45="">1</span> byte: type][<span class="number" data-v-3d7cac45="">2</span> bytes: field_id][value]</code></pre><h3 data-v-3d7cac45="">Schema-Based Mapping</h3><p data-v-3d7cac45="">Field IDs are assigned via a schema dictionary:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45=""><code data-v-3d7cac45="">"_id"</code> â†’ Field ID <code data-v-3d7cac45="">1</code> (2 bytes instead of 4)</li><li data-v-3d7cac45=""><code data-v-3d7cac45="">"email"</code> â†’ Field ID <code data-v-3d7cac45="">2</code> (2 bytes instead of 6)</li><li data-v-3d7cac45=""><code data-v-3d7cac45="">"created_at"</code> â†’ Field ID <code data-v-3d7cac45="">3</code> (2 bytes instead of 11)</li></ul><h3 data-v-3d7cac45="">Benefits</h3><ul data-v-3d7cac45=""><li data-v-3d7cac45=""><strong data-v-3d7cac45="">30-60% smaller documents</strong> - Less storage and faster I/O</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">Zero allocation</strong> - Direct <code data-v-3d7cac45="">Span&lt;byte&gt;</code> operations</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">BSON type compatible</strong> - Same type codes and value encoding</li><li data-v-3d7cac45=""><strong data-v-3d7cac45="">Schema evolution</strong> - Add/remove fields safely</li></ul></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Transaction Flow</h2><pre data-v-3d7cac45=""><code data-v-3d7cac45=""><span class="number" data-v-3d7cac45="">1</span>. BeginTransaction()
   â””â”€&gt; Allocate transaction ID
   â””â”€&gt; Create WAL entry (BEGIN)

<span class="number" data-v-3d7cac45="">2</span>. Write Operations
   â””â”€&gt; Write to WAL <span class="comment" data-v-3d7cac45="">(uncommitted)</span>
   â””â”€&gt; Cache in memory

<span class="number" data-v-3d7cac45="">3</span>. Commit()
   â””â”€&gt; Write WAL commit marker
   â””â”€&gt; Flush to PageFile
   â””â”€&gt; Clear WAL cache

<span class="number" data-v-3d7cac45="">4</span>. Rollback() <span class="comment" data-v-3d7cac45="">(if needed)</span>
   â””â”€&gt; Discard WAL entries
   â””â”€&gt; Restore from checkpoint</code></pre></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Indexing Strategies</h2><h3 data-v-3d7cac45="">B-Tree Index</h3><p data-v-3d7cac45="">Used for:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45="">Primary key lookups</li><li data-v-3d7cac45="">Range queries (<code data-v-3d7cac45="">&gt;</code>, <code data-v-3d7cac45="">&lt;</code>, <code data-v-3d7cac45="">BETWEEN</code>)</li><li data-v-3d7cac45="">Prefix searches (<code data-v-3d7cac45="">StartsWith</code>)</li></ul><h3 data-v-3d7cac45="">R-Tree Index</h3><p data-v-3d7cac45="">Used for:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45="">Geospatial queries</li><li data-v-3d7cac45="">Bounding box searches</li><li data-v-3d7cac45="">Nearest neighbor (k-NN)</li></ul></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Memory Management</h2><p data-v-3d7cac45="">BLite minimizes garbage collection pressure:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45="">âœ… <strong data-v-3d7cac45=""><code data-v-3d7cac45="">stackalloc</code></strong> for temporary buffers</li><li data-v-3d7cac45="">âœ… <strong data-v-3d7cac45=""><code data-v-3d7cac45="">ArrayPool</code></strong> for reusable arrays</li><li data-v-3d7cac45="">âœ… <strong data-v-3d7cac45="">Memory-mapped files</strong> for OS-level caching</li><li data-v-3d7cac45="">âœ… <strong data-v-3d7cac45="">Span&lt;T&gt;</strong> for zero-copy operations</li></ul></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Concurrency Model</h2><p data-v-3d7cac45="">BLite supports <strong data-v-3d7cac45="">multi-threading within a single process</strong>:</p><ul data-v-3d7cac45=""><li data-v-3d7cac45="">âœ… Multiple readers simultaneously</li><li data-v-3d7cac45="">âœ… Single writer at a time (per transaction)</li><li data-v-3d7cac45="">âœ… Snapshot isolation for consistency</li><li data-v-3d7cac45="">âš ï¸ <strong data-v-3d7cac45="">Not designed for multi-process access</strong></li></ul></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Performance Characteristics</h2><table data-v-3d7cac45=""><thead data-v-3d7cac45=""><tr data-v-3d7cac45=""><th data-v-3d7cac45="">Operation</th><th data-v-3d7cac45="">Complexity</th><th data-v-3d7cac45="">Notes</th></tr></thead><tbody data-v-3d7cac45=""><tr data-v-3d7cac45=""><td data-v-3d7cac45="">Insert</td><td data-v-3d7cac45=""><code data-v-3d7cac45="">O(log n)</code></td><td data-v-3d7cac45="">B-Tree index insert</td></tr><tr data-v-3d7cac45=""><td data-v-3d7cac45="">FindById</td><td data-v-3d7cac45=""><code data-v-3d7cac45="">O(log n)</code></td><td data-v-3d7cac45="">Primary key lookup</td></tr><tr data-v-3d7cac45=""><td data-v-3d7cac45="">Range Query</td><td data-v-3d7cac45=""><code data-v-3d7cac45="">O(log n + k)</code></td><td data-v-3d7cac45="">k = result size</td></tr><tr data-v-3d7cac45=""><td data-v-3d7cac45="">Spatial Query</td><td data-v-3d7cac45=""><code data-v-3d7cac45="">O(log n + k)</code></td><td data-v-3d7cac45="">R-Tree search</td></tr><tr data-v-3d7cac45=""><td data-v-3d7cac45="">Full Scan</td><td data-v-3d7cac45=""><code data-v-3d7cac45="">O(n)</code></td><td data-v-3d7cac45="">No index available</td></tr></tbody></table></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Crash Recovery</h2><p data-v-3d7cac45="">BLite uses WAL for durability:</p><pre data-v-3d7cac45=""><code data-v-3d7cac45=""><span class="comment" data-v-3d7cac45="">// On database open</span>
<span class="keyword" data-v-3d7cac45="">if</span> (WAL.Exists())
{
    <span class="comment" data-v-3d7cac45="">// Replay uncommitted transactions</span>
    WAL.Recover();
    
    <span class="comment" data-v-3d7cac45="">// Apply committed writes</span>
    WAL.Flush();
    
    <span class="comment" data-v-3d7cac45="">// Clear WAL</span>
    WAL.Truncate();
}</code></pre></section><section data-v-3d7cac45=""><h2 data-v-3d7cac45="">Design Philosophy</h2><ul data-v-3d7cac45=""><li data-v-3d7cac45="">ğŸ¯ <strong data-v-3d7cac45="">Performance First</strong> - Zero allocation wherever possible</li><li data-v-3d7cac45="">ğŸ›¡ï¸ <strong data-v-3d7cac45="">ACID Compliance</strong> - Full transaction support</li><li data-v-3d7cac45="">ğŸš€ <strong data-v-3d7cac45="">Modern .NET</strong> - Leverage Span&lt;T&gt;, Memory&lt;T&gt;</li><li data-v-3d7cac45="">ğŸ”§ <strong data-v-3d7cac45="">Developer Experience</strong> - LINQ, attributes, source generators</li><li data-v-3d7cac45="">ğŸ“¦ <strong data-v-3d7cac45="">Embedded First</strong> - No external dependencies</li></ul></section></div></div></main></div></main><footer class="main-footer" data-v-94ca611f=""><div class="container" data-v-94ca611f=""><p data-v-94ca611f="">Â© 2026 BLite Project. Open Source (MIT).</p><p class="tagline" data-v-94ca611f="">"Sky is Blite, no Clouds today."</p></div></footer></div></div></body></html>